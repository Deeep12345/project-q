<!DOCTYPE html>
<!--  Last Published: Fri Apr 03 2020 07:16:42 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="5e841deb90c30658ed7b8d3f" data-wf-site="5e7b9ae24c46c726e716ecf3">

<head>
  <meta charset="utf-8">
  <title>Project Q</title>
  <meta
    content="Discover now your next favorite space to study or work and start your study or work session hassle-free. Wait, do you prefer something a little bit more professional? You&#x27;re more than welcome to enjoy our distributed network of smart restaurants, it&#x27;s like in a coworking, but it&#x27;s not."
    name="description">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="../css/normalize.css" rel="stylesheet" type="text/css">
  <link href="../css/webflow.css" rel="stylesheet" type="text/css">
  <link href="../css/project-queue.webflow.css" rel="stylesheet" type="text/css">
  <script src="../js/angular.min.js" type="text/javascript"></script>
  <script src="https://unpkg.com/@mapbox/mapbox-sdk/umd/mapbox-sdk.min.js"></script>
  <!-- [if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif] -->
  <script type="text/javascript">
    ! function (o, c) {
      var n = c.documentElement,
        t = " w-mod-";
      n.className += t + "js", ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch")
    }(window, document);
  </script>
  <link href="../images/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="../images/icon_512.png" rel="apple-touch-icon">
  <style rel="stylesheet">
    .waiting {
      width: 100%;
      position: absolute;
      height: 100%;
      top: 0px;
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      left: 0px;
    }

    .waiting>span {
      width: 7px;
      height: 7px;
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      background-color: #fff;
      margin: 0 5px;

      border-radius: 50%;
      display: inline-block;
      animation-name: dots;
      animation-duration: 2s;
      animation-iteration-count: infinite;
      animation-timing-function: ease-in-out;
    }

    .waiting span:nth-child(2) {
      animation-delay: 0.4s;
    }

    .waiting span:nth-child(3) {
      animation-delay: 0.8s;
    }

    @keyframes dots {
      50% {
        opacity: 0;
        transform: scale(0.7) translateY(10px);
      }
    }
  </style>
</head>

<body class="body center" ng-app="addApp" ng-controller="addCtrl">
  <div class="main_div" style="margin: 0;">
    <div class="header_div" style="margin-top: 0;">
      <h1 class="heading-4">Presso quale supermercato ti trovi?</h1>
    </div>
    <div class="form-block-2 w-form">
      <form>

        <input type="text" class="text-field-3 w-input" autofocus="false" maxlength="256" name="Supermarket-address"
          data-name="Supermarket address" ng-keyup="getHints('name')" ng-model="name"
          placeholder="Nome del supermercato" required="">
        <div ng-if="hints.length > 0 && isTyping === 'name'"
          style="position: relative;width: 100%;margin-top: -30px;z-index: 1050;">
          <div style="position: absolute;width: 100%;color: #fff;font-size: 18px;font-weight: normal;background-color: #fff;
        border-radius: 10px;">
            <ul style="padding-left: 15px;">
              <li style="list-style-type: none;cursor:pointer;" ng-click="updateAddress(h)" ng-repeat="h in hints">
                <div style="text-align:left;font-size:16px;font-weight: normal;color: #000;" ng-cloak>{{h.name}}</div>
                <div style="text-align:left;font-size:16px;font-weight: normal;color: #999;" ng-cloak>{{h.address}}
                </div>
                <div ng-if="$index < hints.length - 1"
                  style="border-bottom: 1px solid #ddd; margin-right:15px;margin-top: 5px;" />
              </li>
            </ul>
          </div>
        </div>
        <input type="text" class="text-field-3 w-input" autofocus="false" maxlength="256" ng-keyup="getHints('address')"
          ng-model="address" placeholder="Indirizzo del supermercato" required="">
        <div ng-if="hints.length > 0 &&  isTyping === 'address'"
          style="position: relative;width: 100%;margin-top: -30px;z-index: 1050;">
          <div style="position: absolute;width: 100%;color: #fff;font-size: 18px;font-weight: normal;background-color: #fff;
        border-radius: 10px;">
            <ul style="padding-left: 15px;">
              <li style="list-style-type: none;cursor:pointer;" ng-click="updateAddress(h)" ng-repeat="h in hints">
                <div style="text-align:left;font-size:16px;font-weight: normal;color: #000;" ng-cloak>{{h.name}}</div>
                <div style="text-align:left;font-size:16px;font-weight: normal;color: #999;" ng-cloak>{{h.address}}
                </div>
                <div ng-if="$index < hints.length - 1"
                  style="border-bottom: 1px solid #ddd; margin-right:15px;margin-top: 5px;" />
              </li>
            </ul>
          </div>
        </div>

        <div ng-if="(name.length > 0 || address.length > 0) && hints.length === 0 && !isButtonActive"
          style="margin: 30px 0;color: #888;">
          <div>Il supermercato da te cercato non è presente.</div>
          <a href="/add" class="link-3">Aggiungilo e aiuta la community</a>
        </div>
        <div ng-if="isButtonActive" style="margin: 30px 0;">
          <a href="#" ng-click="reset()" class="link-3">Non è il risultato che cercavo</a>
        </div>
        <button ng-click="getAddress()" ng-disabled="!isButtonActive" class="submit-button w-button"
          style="position: relative;margin-bottom: 0;margin-left: auto;margin-right: auto;"
          ng-style="{height: loading ? '42px' : 'auto'}">
          <div ng-if="loading" class="waiting">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <span ng-if="!loading" ng-cloak>{{buttonText}}</span>
        </button>
      </form>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.4.1.min.220afd743d.js?site=5e7b9ae24c46c726e716ecf3"
    type="text/javascript" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>
  <script src="../js/webflow.js" type="text/javascript"></script>
  <script type="text/javascript">
    var geocodingClient = mapboxSdk({ accessToken: 'pk.eyJ1IjoicXNwYXRpb24iLCJhIjoiY2s4MW85cm50MGJjdjNmbDkxZmtwY2ExbyJ9.qi-2tdukdDJhH7kZWttiRA' });


    var app = angular.module('addApp', []);
    app.controller("addCtrl", function ($scope, $http, $window) {

      $scope.name = "";
      $scope.address = "";
      $scope.isTyping = '';
      $scope.hints = [];
      $scope.isButtonActive = false;
      $scope.buttonText = "Conferma";
      $scope.path = (address) => {
        return `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURI(address)}.json?types=address&access_token=pk.eyJ1IjoicXNwYXRpb24iLCJhIjoiY2s4MW85cm50MGJjdjNmbDkxZmtwY2ExbyJ9.qi-2tdukdDJhH7kZWttiRA`;
      };
      $scope.loading = false;
      $scope.clear = () => {
        $scope.buttonText = 'Conferma';
        $scope.name = '';
      };
      $scope.loading = true;
      $scope.supermarkets = [];
      function autocomplete(text, callback) {
        geocodingClient.geocoding.forwardGeocode({
          query: text,
          countries: ['It'],
          autocomplete: true,
          limit: 5,
        })
          .send()
          .then(response => {
            const match = response.body;
            callback(match);
          });
      }
      $scope.updateAddress = (hint) => {
        // $scope.$apply(() => {
        $scope.id = hint._id;
        $scope.buttonText = "Avanti";
        $scope.address = hint.address;
        $scope.name = hint.name;
        $scope.hints = [];
        $scope.isButtonActive = true;
        $scope.isTyping = '';
        //});      
      };
      // $scope.submitAddress = () => {
      //   $http.post('/', {data: {name: $scope.supermarket, address: $scope.userAddress }});
      //   $window.location.href = '/main';
      // };
      // $scope.getHints = function(e) {
      //   autocomplete($scope.userAddress, function (results) {
      //       $scope.hints = results.features;
      //   });
      // };
      $scope.getAddress = async () => {

        if ($scope.buttonText === 'Avanti') {
          console.log("in get address " + $scope.buttonText + " " + $scope.id);
          // $http.get('/update/'+$scope.id);   
          $window.location.href = '/update/' + $scope.id;
          //return;
        } else {
          $scope.$apply(() => {
            $scope.buttonText = "Avanti";
          });
        }
      };
      $scope.reset = () => {
        $scope.name = '';
        $scope.address = '';
        $scope.isButtonActive = false;
      };
      $scope.getHints = (type) => {
        $scope.isTyping = type;
        var isButtonActive = false;
        $scope.hints = $scope.supermarkets.filter((item) => {
          return $scope[type].length > 0 && item[type].toLowerCase().indexOf($scope[type].trim().toLowerCase()) !== -1;
        });
        $scope.isButtonActive = false;
      };

      var getSuperMarkets = async () => {
        if ($scope.supermarkets.length === 0) {
          var res = await $http.get("/supermarkets");
          $scope.supermarkets = res.data;
          $scope.$apply(() => {
            $scope.loading = false;
          });
        }
      };
      getSuperMarkets();
    });
  </script>
  <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
</body>

</html>